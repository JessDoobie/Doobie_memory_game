<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Host ‚Ä¢ Memory Match</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="wrap">
    <h1>üéõÔ∏è Host Dashboard</h1>
    <p class="muted">Create a lobby, share the join code with your chat.</p>

    <div class="card">
      <div class="row">
        <label>Host Key</label>
        <input id="hostKey" placeholder="Enter host key" />
      </div>

      <div class="row">
        <label>Mode</label>
        <select id="mode">
          <option value="solo">Solo</option>
          <option value="teams">Teams</option>
        </select>
      </div>

      <div class="row">
        <label>Board Size</label>
        <select id="size">
          <option value="4">4x4 (quick)</option>
          <option value="6" selected>6x6 (standard)</option>
        </select>
      </div>

      <div class="row">
        <label>Entry</label>
        <select id="entryMode">
          <option value="free" selected>Free</option>
          <option value="ticket">Ticket Required</option>
        </select>
      </div>

      <button class="btn" id="createBtn">Create Lobby</button>
      <p class="tiny muted" style="margin-top:10px;">
        Bookmark your secret host link so your key auto-fills.
      </p>
    </div>

    <div class="card" id="lobbyCard" style="display:none">
      <h2>Lobby</h2>
      <div class="pill">Code: <span id="code"></span></div>

      <div class="muted tiny" style="margin-top:8px; line-height:1.5;">
        Join link: <span id="joinLink"></span>
        <button class="btn outline" id="copyJoinBtn">Copy</button><br/>

        Player view: <span id="playLink"></span>
        <button class="btn outline" id="copyPlayBtn">Copy</button><br/>

        Spectator link: <span id="watchLink"></span>
        <button class="btn outline" id="copyWatchBtn">Copy</button>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <button class="btn" id="startBtn">Start Round</button>
        <button class="btn outline" id="endBtn">End Round</button>
        <button class="btn outline" id="resetBtn">Next Round</button>
        <a class="btn outline" id="openPlayBtn" href="#" target="_blank">Open Player View</a>
      </div>

      <div class="hr"></div>

      <div class="row">
        <div><b>Status:</b> <span id="status"></span></div>
        <div><b>Players:</b> <span id="playersCount"></span> / 10</div>
      </div>

      <!-- PRIZES -->
      <div class="hr"></div>
      <h3>Prizes</h3>
      <div class="row"><label>1st</label><input id="p1"></div>
      <div class="row"><label>2nd</label><input id="p2"></div>
      <div class="row"><label>3rd</label><input id="p3"></div>
      <button class="btn outline" id="savePrizesBtn">Save Prizes</button>

      <!-- WINNERS -->
      <div id="winnersCard" class="card inner" style="display:none;margin-top:14px;">
        <h3 style="margin-top:0;">üèÜ Winners</h3>
        <div id="winnersBox" class="tiny"></div>
        <button class="btn outline" id="copyWinnersBtn" style="margin-top:10px;">
          üìã Copy Winners
        </button>
      </div>

      <!-- PLAYERS -->
      <div class="hr"></div>
      <h3>Players</h3>
      <div id="playersBox"></div>

      <!-- LEADERBOARD -->
      <div class="hr"></div>
      <h3>Leaderboard</h3>
      <div id="teamsBox" style="display:none"></div>
      <div id="lb"></div>
    </div>
  </div>

<script>
function el(id){ return document.getElementById(id); }
function esc(s){ return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

async function copyText(txt){
  try{ await navigator.clipboard.writeText(txt); alert("Copied!"); }
  catch{ alert("Copy failed"); }
}

let lobbyCode = null;
let lastWinnersText = "";

function renderWinners(lobby, lb){
  const prizes = lobby.prizes || {};
  if(lobby.status !== "ended"){ el("winnersCard").style.display="none"; return; }

  let lines = [];
  let html = "";

  if(lobby.mode === "teams"){
    const t = lb.teams || [];
    if(prizes["1"] && t[0]){ lines.push(`1st (${prizes["1"]}): ${t[0].team}`); }
    if(prizes["2"] && t[1]){ lines.push(`2nd (${prizes["2"]}): ${t[1].team}`); }
    if(prizes["3"] && t[2]){ lines.push(`3rd (${prizes["3"]}): ${t[2].team}`); }
  } else {
    const p = lb.players || [];
    if(prizes["1"] && p[0]){ lines.push(`1st (${prizes["1"]}): ${p[0].name}`); }
    if(prizes["2"] && p[1]){ lines.push(`2nd (${prizes["2"]}): ${p[1].name}`); }
    if(prizes["3"] && p[2]){ lines.push(`3rd (${prizes["3"]}): ${p[2].name}`); }
  }

  html = lines.map(l => `<div>${esc(l)}</div>`).join("");
  lastWinnersText = lines.join("\n");

  el("winnersBox").innerHTML = html;
  el("winnersCard").style.display = "block";
}

el("copyWinnersBtn").onclick = () => {
  if(lastWinnersText) copyText(lastWinnersText);
};
</script>
</body>
</html>
