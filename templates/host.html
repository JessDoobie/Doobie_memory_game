<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Host ‚Ä¢ Memory Match</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="wrap">
    <h1>üéõÔ∏è Host Dashboard</h1>
    <p class="muted">Create a lobby, then share the code with your chat.</p>

    <div class="card">
      <div class="row">
        <label>Mode</label>
        <select id="mode">
          <option value="solo" selected>Solo</option>
          <option value="teams">Teams</option>
        </select>
      </div>

      <div class="row">
        <label>Board</label>
        <select id="preset">
          <option value="quick">Quick (4√ó4 ‚Ä¢ 16 cards)</option>
          <option value="standard" selected>Standard (4√ó5 ‚Ä¢ 20 cards)</option>
          <option value="extended">Extended (4√ó6 ‚Ä¢ 24 cards)</option>
        </select>
      </div>

      <div class="row">
        <label>Entry</label>
        <select id="entry">
          <option value="free" selected>Free</option>
          <option value="paid">Paid (ticket code)</option>
        </select>
      </div>

      <button class="btn" id="createBtn">Create Lobby</button>
      <p class="tiny muted" id="createMsg" style="margin-top:10px;"></p>
    </div>

    <div class="card" id="lobbyBox" style="display:none;">
      <h3>Lobby</h3>
      <div class="hr"></div>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <span class="pill">Code: <span id="codeText"></span></span>
        <button class="btn outline" id="copyCodeBtn">Copy Code</button>
      </div>

      <div class="hr"></div>

      <div class="grid2">
        <div class="card inner">
          <div class="tiny muted">Join page</div>
          <div id="joinLink" style="word-break:break-all;"></div>
          <button class="btn outline" id="copyJoinBtn" style="margin-top:8px;">Copy</button>
        </div>

        <div class="card inner">
          <div class="tiny muted">Direct play link</div>
          <div id="playLink" style="word-break:break-all;"></div>
          <button class="btn outline" id="copyPlayBtn" style="margin-top:8px;">Copy</button>
        </div>

        <div class="card inner">
          <div class="tiny muted">Spectator link (view-only)</div>
          <div id="watchLink" style="word-break:break-all;"></div>
          <button class="btn outline" id="copyWatchBtn" style="margin-top:8px;">Copy</button>
        </div>

        <div class="card inner">
          <div class="tiny muted">Chat Blurb</div>
          <textarea id="chatBlurb" rows="7" readonly></textarea>
          <button class="btn outline" id="copyBlurbBtn" style="margin-top:8px;">üìã Copy Chat Blurb</button>
        </div>
      </div>

      <div class="hr"></div>

      <button class="btn" id="startBtn">Start Game</button>
      <p class="tiny muted" id="startMsg" style="margin-top:10px;"></p>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);

  function copyText(txt){
    navigator.clipboard.writeText(txt).catch(()=>{});
  }

  let lastCode = null;

  $("createBtn").onclick = async () => {
    $("createMsg").textContent = "Creating‚Ä¶";
    $("lobbyBox").style.display = "none";
    lastCode = null;

    try{
      const res = await fetch("/api/create_lobby", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          mode: $("mode").value,
          preset: $("preset").value,
          entry: $("entry").value
        })
      });
      const out = await res.json();
      if(!out.ok){
        $("createMsg").textContent = out.error || "Could not create lobby.";
        return;
      }

      lastCode = out.code;
      $("createMsg").textContent = "Lobby created ‚úÖ";
      $("lobbyBox").style.display = "block";

      const base = window.location.origin;
      const code = out.code;

      const joinUrl = base + "/join";
      const playUrl = base + "/play/" + code;
      const watchUrl = base + "/watch/" + code;

      $("codeText").textContent = code;
      $("joinLink").textContent = joinUrl;
      $("playLink").textContent = playUrl;
      $("watchLink").textContent = watchUrl;

      const presetLabel = out.preset_label || "Standard";
      const dims = out.rows + "√ó" + out.cols;
      const cards = out.total + " cards";

      $("chatBlurb").value =
`üÉè Memory Match is LIVE!
Go to: ${joinUrl}
Click Join a Game
Enter CODE: ${code}
üìå Board: ${presetLabel} (${dims} ‚Ä¢ ${cards})
üëÄ Spectate: ${watchUrl}`;

    }catch(e){
      $("createMsg").textContent = "Error creating lobby.";
    }
  };

  $("startBtn").onclick = async () => {
    if(!lastCode) return;
    $("startMsg").textContent = "Starting‚Ä¶";
    try{
      const res = await fetch("/api/start", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ code: lastCode })
      });
      const out = await res.json();
      $("startMsg").textContent = out.ok ? "Game started ‚úÖ (joining locked)" : (out.error || "Could not start.");
    }catch(e){
      $("startMsg").textContent = "Error starting.";
    }
  };

  $("copyCodeBtn").onclick = ()=> lastCode && copyText(lastCode);
  $("copyJoinBtn").onclick = ()=> copyText($("joinLink").textContent);
  $("copyPlayBtn").onclick = ()=> copyText($("playLink").textContent);
  $("copyWatchBtn").onclick = ()=> copyText($("watchLink").textContent);
  $("copyBlurbBtn").onclick = ()=> copyText($("chatBlurb").value);
</script>
</body>
</html>
