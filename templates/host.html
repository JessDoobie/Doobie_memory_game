<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Host ‚Ä¢ Memory Match</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="wrap">
    <h1>üéõÔ∏è Host Dashboard</h1>
    <p class="muted">Create a lobby, then share the code with your chat.</p>

    <div class="card">
      <div class="row">
        <label>Mode</label>
        <select id="mode">
          <option value="solo" selected>Solo</option>
          <option value="teams">Teams</option>
        </select>
      </div>

      <div class="row">
        <label>Board Size</label>
        <select id="size">
          <option value="4">4x4 (quick)</option>
          <option value="6" selected>6x6 (standard)</option>
        </select>
      </div>

      <div class="row">
        <label>Players</label>
        <select id="max_players">
          <option value="5">5</option>
          <option value="8">8</option>
          <option value="10" selected>10</option>
        </select>
      </div>

      <button class="btn" id="createBtn">Create Lobby</button>
      <p class="tiny muted" id="msg" style="margin-top:10px;"></p>
    </div>

    <div class="card" id="lobbyBox" style="display:none;">
      <h3>Lobby</h3>
      <p><span class="pill">Code: <span id="codeText"></span></span></p>

      <div class="hr"></div>

      <div class="grid2">
        <div>
          <div class="tiny muted">Join page</div>
          <div><code id="joinLink"></code></div>
        </div>
        <div>
          <div class="tiny muted">Direct play link</div>
          <div><code id="playLink"></code></div>
        </div>
      </div>

      <div class="hr"></div>

      <button class="btn" id="startBtn">Start Game</button>
      <p class="tiny muted" style="margin-top:8px;">Players will see ‚Äúwaiting‚Äù until you start.</p>
    </div>
  </div>

  <script>
    const msg = document.getElementById("msg");
    const lobbyBox = document.getElementById("lobbyBox");
    const codeText = document.getElementById("codeText");
    const joinLink = document.getElementById("joinLink");
    const playLink = document.getElementById("playLink");

    let currentCode = null;

    document.getElementById("createBtn").onclick = async () => {
      msg.textContent = "Creating lobby‚Ä¶";
      lobbyBox.style.display = "none";
      currentCode = null;

      try{
        const size = parseInt(document.getElementById("size").value, 10);
        const mode = document.getElementById("mode").value;
        const max_players = parseInt(document.getElementById("max_players").value, 10);

        const res = await fetch("/api/create", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ size, mode, max_players })
        });

        const out = await res.json();

        if(!out.ok){
          msg.textContent = "Could not create lobby.";
          return;
        }

        currentCode = out.code;
        msg.textContent = "Lobby created ‚úÖ";

        const base = window.location.origin;
        codeText.textContent = currentCode;
        joinLink.textContent = `${base}/join`;
        playLink.textContent = `${base}/play/${currentCode}`;

        lobbyBox.style.display = "block";
      }catch(e){
        msg.textContent = "Error creating lobby (check Render logs).";
      }
    };

    document.getElementById("startBtn").onclick = async () => {
      if(!currentCode){
        msg.textContent = "Create a lobby first.";
        return;
      }

      msg.textContent = "Starting‚Ä¶";

      try{
        const res = await fetch("/api/start", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ code: currentCode })
        });

        const out = await res.json();
        msg.textContent = out.ok ? "Game started ‚úÖ" : "Could not start game.";
      }catch(e){
        msg.textContent = "Error starting game.";
      }
    };
  </script>
</body>
</html>
