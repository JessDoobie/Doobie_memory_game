<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Host ‚Ä¢ Memory Match</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="wrap">

    <div class="topbar">
      <h1>üé≤ Host Dashboard</h1>
    </div>

    <!-- CREATE LOBBY -->
    <div class="card">
      <p class="muted">Create a lobby, then share the code with your chat.</p>

      <div class="row">
        <label for="mode">Mode</label>
        <select id="mode">
          <option value="solo" selected>Solo</option>
        </select>
      </div>

      <div class="row">
        <label for="board">Board</label>
        <select id="board">
          <option value="standard" selected>Standard (4√ó5 ‚Ä¢ 20 cards)</option>
          <option value="extended">Extended (4√ó6 ‚Ä¢ 24 cards)</option>
        </select>
      </div>

      <div class="row">
        <label for="entry">Entry</label>
        <select id="entry">
          <option value="free" selected>Free</option>
        </select>
      </div>

      <button id="createBtn" class="btn">Create Lobby</button>

      <div id="createStatus" class="tiny muted" style="margin-top:8px;"></div>
    </div>

    <!-- LOBBY INFO -->
    <div id="lobbyBox" class="card" style="display:none;">
      <h3>Lobby</h3>

      <div class="pill" id="codePill">Code: ----</div>

      <div class="hr"></div>

      <p class="tiny muted">
        Join page:<br>
        <strong id="joinLink"></strong>
      </p>

      <p class="tiny muted">
        Direct play link:<br>
        <strong id="playLink"></strong>
      </p>

      <button id="startBtn" class="btn">Start Game</button>

      <p class="tiny muted" style="margin-top:6px;">
        Players will see ‚Äúwaiting‚Äù until you start.
      </p>
    </div>

  </div>

  <script>
    const createBtn = document.getElementById("createBtn");
    const startBtn  = document.getElementById("startBtn");
    const statusEl  = document.getElementById("createStatus");
    const lobbyBox  = document.getElementById("lobbyBox");
    const codePill  = document.getElementById("codePill");
    const joinLink  = document.getElementById("joinLink");
    const playLink  = document.getElementById("playLink");

    let currentCode = null;

    createBtn.onclick = async () => {
      statusEl.textContent = "Creating lobby‚Ä¶";

      const res = await fetch("/api/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          mode: document.getElementById("mode").value,
          board: document.getElementById("board").value,
          entry: document.getElementById("entry").value
        })
      });

      const data = await res.json();

      if (!data.ok) {
        statusEl.textContent = data.error || "Failed to create lobby.";
        return;
      }

      currentCode = data.code;

      statusEl.textContent = "Lobby created ‚úì";
      lobbyBox.style.display = "block";

      codePill.textContent = "Code: " + currentCode;
      joinLink.textContent = location.origin + "/join";
      playLink.textContent = location.origin + "/play/" + currentCode;
    };

    startBtn.onclick = async () => {
      if (!currentCode) return;

      startBtn.disabled = true;
      startBtn.textContent = "Starting‚Ä¶";

      await fetch("/api/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: currentCode })
      });

      startBtn.textContent = "Game Started";
    };
  </script>
</body>
</html>
